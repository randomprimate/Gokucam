{% extends "base.html" %}
{% block title %}GokuCam Gallery{% endblock %}
{% block body %}
<h2>Gallery</h2>
<p><a href="{{ url_for('ui.index') }}">← Back</a></p>

{% if not groups %}
  <p>No captures yet.</p>
{% else %}
  {% for date, items in groups %}
    <h3 style="text-align:left">{{ date }}</h3>
    <ul class="gallery">
      {% for it in items %}
        <li id="item-{{ it.name|e }}">
          {% if it.ext == '.jpg' %}
            <a href="{{ it.url }}"><img src="{{ it.url }}" alt="{{ it.name }}"></a>
          {% elif it.ext in ['.mp4', '.avi'] %}
            <video src="{{ it.url }}" controls></video>
          {% else %}
            <a href="{{ it.url }}">{{ it.name }}</a>
          {% endif %}
          {% if it.has_sidecar %}
            <div class="sidecar-indicator" title="Has associated JSON data">J</div>
          {% endif %}
          <div class="meta">
            <div class="fn">{{ it.name }}</div>
            <div class="sub">{{ it.time }} • {{ (it.size/1024)|round(1) }} KB</div>
            <div class="actions">
              <a href="{{ it.url }}" download>Download</a>
              {% if it.ext in ['.mp4', '.jpg', '.avi'] %}
                <button onclick="delItem('{{ it.name|e }}')">Delete</button>
              {% endif %}
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% endfor %}
{% endif %}

<script>
async function delItem(name){
  if(!confirm(`Delete ${name}? This cannot be undone.`)) return;
  const r = await fetch('/api/delete', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({name})
  });
  const j = await r.json();
  if(j.ok){
    const el = document.getElementById('item-'+name);
    if(el) el.remove();
  }else{
    alert('Delete failed: ' + (j.error || 'unknown'));
  }
}
</script>
{% endblock %}
