<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>GokuCam Live</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="wrap">
    <h2>GokuCam Live</h2>
    <div class="nav">
      <a href="{{ url_for('gallery') }}">ğŸ“ Gallery</a>
    </div>
    <img src="/stream.mjpg" alt="Live stream" />
    <div class="stat">Pan: <span id="pan">0</span>Â° &nbsp; Tilt: <span id="tilt">0</span>Â°</div>

    <div class="controls">
      <button onclick="tilt(-1)">Tilt â†‘</button>
      <div></div>
      <button onclick="center()">Center</button>
      <div></div>
      <button onclick="tilt(1)">Tilt â†“</button>

      <button onclick="pan(-1)">Pan â†</button>
      <div></div>
      <div></div>
      <div></div>
      <button onclick="pan(1)">Pan â†’</button>

      <button class="wide" onclick="sweep()">Sweep demo</button>
      <button class="wide" onclick="snapshot()">ğŸ“¸ Snapshot</button>
      <button class="wide" onclick="record()">ğŸ¥ Record 10 s</button>
    </div>

    <div class="row" style="margin-top:8px;">
      <span class="pill">Arrow keys: move</span>
      <span class="pill">C: center</span>
      <span class="pill">Shift: bigger step</span>
    </div>

  </div>

<script>
let STEP = Number({ step });
function updateState(s) {
  if ('pan' in s)  document.getElementById('pan').innerText  = s.pan;
  if ('tilt' in s) document.getElementById('tilt').innerText = s.tilt;
}
async function pan(dir) {
  const r = await fetch(`/api/pan?step=${dir*STEP}`, {method:'POST'});
  updateState(await r.json());
}
async function tilt(dir) {
  const r = await fetch(`/api/tilt?step=${dir*STEP}`, {method:'POST'});
  updateState(await r.json());
}
async function center() {
  const r = await fetch('/api/center', {method:'POST'});
  updateState(await r.json());
}
async function sweep() {
  const r = await fetch('/api/sweep', {method:'POST'});
  updateState(await r.json());
}
document.addEventListener('keydown', async (e) => {
  if (e.key === 'ArrowLeft')  return pan(-(e.shiftKey?2:1));
  if (e.key === 'ArrowRight') return pan( (e.shiftKey?2:1));
  if (e.key === 'ArrowUp')    return tilt(-(e.shiftKey?2:1));
  if (e.key === 'ArrowDown')  return tilt( (e.shiftKey?2:1));
  if (e.key.toLowerCase() === 'c') return center();
});
async function snapshot() {
  const r = await fetch('/api/snapshot', {method:'POST'});
  const j = await r.json();
  alert(j.saved ? `Saved snapshot:\n${j.saved}` : `Snapshot failed:\n${j.error||'unknown'}`);
}
async function record() {
  const r = await fetch('/api/record?secs=10', {method:'POST'});
  const j = await r.json();
  alert(j.saved ? `Saved clip:\n${j.saved}` : `Recording failed:\n${j.error||'unknown'}`);
}
</script>
</body>
</html>
