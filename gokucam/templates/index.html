<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>GokuCam Live</title>
  <style>
    body { background:#111; color:#eee; font-family: system-ui, Arial; margin:0; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 16px; text-align:center; }
    img { width: 100%; max-width: 960px; border-radius: 12px; background:#000; }
    .controls { margin-top: 12px; display: grid; gap: 8px; grid-template-columns: repeat(5, minmax(0,1fr)); }
    button { padding:10px 12px; border-radius:10px; border:1px solid #333; background:#222; color:#eee; cursor:pointer; }
    button:hover { background:#2c2c2c; }
    .wide { grid-column: span 5; }
    .row { display:flex; gap:8px; justify-content:center; }
    .pill { padding:6px 10px; border:1px solid #333; border-radius:999px; font-size:12px; color:#bbb; }
    .stat { margin-top:8px; color:#aaa; font-size:13px; }
    a { color:#6cf; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>GokuCam Live</h2>
    <img src="/stream.mjpg" alt="Live stream" />
    <div class="stat">Pan: <span id="pan">0</span>¬∞ &nbsp; Tilt: <span id="tilt">0</span>¬∞</div>

    <div class="controls">
      <button onclick="tilt(-1)">Tilt ‚Üë</button>
      <div></div>
      <button onclick="center()">Center</button>
      <div></div>
      <button onclick="tilt(1)">Tilt ‚Üì</button>

      <button onclick="pan(-1)">Pan ‚Üê</button>
      <div></div>
      <div></div>
      <div></div>
      <button onclick="pan(1)">Pan ‚Üí</button>

      <button class="wide" onclick="sweep()">Sweep demo</button>
      <button class="wide" onclick="snapshot()">üì∏ Snapshot</button>
      <button class="wide" onclick="record()">üé• Record 10 s</button>
    </div>

    <div class="row" style="margin-top:8px;">
      <span class="pill">Arrow keys: move</span>
      <span class="pill">C: center</span>
      <span class="pill">Shift: bigger step</span>
    </div>

    <p style="margin-top:14px;color:#888;font-size:13px;">Tip: keep servos on a stable 5V supply; share GND with the Pi.</p>
  </div>

<script>
let STEP = parseInt("{{ step_deg }}");
function updateState(s) {
  if ('pan' in s)  document.getElementById('pan').innerText  = s.pan;
  if ('tilt' in s) document.getElementById('tilt').innerText = s.tilt;
}
async function pan(dir) {
  const r = await fetch(`/api/pan?step=${dir*STEP}`, {method:'POST'});
  updateState(await r.json());
}
async function tilt(dir) {
  const r = await fetch(`/api/tilt?step=${dir*STEP}`, {method:'POST'});
  updateState(await r.json());
}
async function center() {
  const r = await fetch('/api/center', {method:'POST'});
  updateState(await r.json());
}
async function sweep() {
  const r = await fetch('/api/sweep', {method:'POST'});
  updateState(await r.json());
}
document.addEventListener('keydown', async (e) => {
  if (e.key === 'ArrowLeft')  return pan(-(e.shiftKey?2:1));
  if (e.key === 'ArrowRight') return pan( (e.shiftKey?2:1));
  if (e.key === 'ArrowUp')    return tilt(-(e.shiftKey?2:1));
  if (e.key === 'ArrowDown')  return tilt( (e.shiftKey?2:1));
  if (e.key.toLowerCase() === 'c') return center();
});
async function snapshot() {
  const r = await fetch('/api/snapshot', {method:'POST'});
  const j = await r.json();
  alert(j.saved ? `Saved snapshot:\n${j.saved}` : `Snapshot failed:\n${j.error||'unknown'}`);
}
async function record() {
  const r = await fetch('/api/record?secs=10', {method:'POST'});
  const j = await r.json();
  alert(j.saved ? `Saved clip:\n${j.saved}` : `Recording failed:\n${j.error||'unknown'}`);
}
</script>
</body>
</html>
